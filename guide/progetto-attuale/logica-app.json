{
  "last_update": "2026-02-13T19:10:00Z",
  "task_completed": "Refactoring Bid Service & Chiusura Automatica Aste",
  "feature_logic": {
    "feature_name": "Auction Closing Logic & League Lifecycle",
    "summary": "Implementata logica robusta per la chiusura delle aste e l'assegnazione automatica dei giocatori quando una lega cambia stato (es. 'market_closed'). Il refactoring di 'bid.service.ts' ha corretto errori di annidamento e introdotto la funzione 'closeAllActiveAuctionsForLeague' che gestisce atomicamente chiusura asta, sblocco crediti, assegnazione giocatore e notifica socket.",
    "architectural_pattern": "Transactional Service Layer + Dynamic Import Hook",
    "user_flow": [
      "1. Admin/Sistema cambia stato lega a 'market_closed' o 'completed' tramite 'updateLeagueStatus'.",
      "2. 'updateLeagueStatus' importa dinamicamente 'bid.service' (per evitare ciclicit√†) e chiama 'closeAllActiveAuctionsForLeague'.",
      "3. Il sistema itera su tutte le aste attive della lega.",
      "4. [Con Offerte]: Chiude l'asta, assegna giocatore al vincitore, scala budget, aggiorna conteggi rosa.",
      "5. [Senza Offerte]: Chiude l'asta senza assegnazione.",
      "6. Notifiche Socket inviate in real-time per aggiornare le UI dei client."
    ]
  },
  "data_cleanup": {
    "target": "N/A",
    "action": "N/A",
    "reason": "N/A"
  }
}
