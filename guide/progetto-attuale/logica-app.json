{
  "last_update": "2026-02-14T21:45:00Z",
  "task_completed": "FN-7 - Activity Log & Bug Fixes",
  "feature_logic": {
    "feature_name": "Activity Log & Sistema Notifiche",
    "summary": "Pagina di log attivit√† per visualizzare cronologia eventi della lega. Filtri avanzati multi-select per tipo evento. Fix critici su concorrenza scheduler (lock) e routing notifiche socket (localhost instradamento).",
    "architectural_pattern": "Scheduler con lock concurrency guard. Socket Emitter con auto-detect ambiente (Railway vs Vercel). UI Activity Log con filtri client-side e paginazione server-side.",
    "user_flow": [
      "1. Utente accede a pagina 'Log' dal menu.",
      "2. Visualizza lista eventi impaginata.",
      "3. Filtra per utente, range date, e multi-selezione tipi evento (es. Offerte + Aste Concluse).",
      "4. Sistema di notifiche socket ora usa instradamento interno su Railway per evitare 404.",
      "5. Scheduler processa aste in background ogni 5s con lock per evitare saturazione DB."
    ],
    "core_components_interaction": {
      "src/app/activity-log/page.tsx": "Pagina server-side container.",
      "src/components/activity-log/ActivityLogClient.tsx": "UI Client con filtri multi-select e lista eventi.",
      "src/lib/scheduler.ts": "Gestore task background con concurrency lock.",
      "src/lib/socket-emitter.ts": "Emettitore eventi con logica smart per URL (localhost su Railway, public su Vercel)."
    },
    "database_interactions": [
      {
        "table": "bids, auctions, budget_transactions, user_sessions",
        "operation": "SELECT / JOIN",
        "description": "Aggregazione eventi per activity log."
      },
      {
        "table": "budget_transactions",
        "operation": "INSERT",
        "description": "Fix su transaction_type 'win_auction_debit' per vincolo CHECK."
      }
    ]
  }
}
